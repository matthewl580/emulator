{
  "initCode": "// Drawing App Init\nwindow._state = {\n  drawing: false,\n  lastX: 0,\n  lastY: 0,\n  color: '#ffffff',\n  size: 2,\n  history: [],\n  redoStack: [],\n  canvas: null,\n  ctx: null,\n  tool: 'pencil', // pencil, line, rect, circle\n  startX: 0,\n  startY: 0,\n  previewCanvas: null,\n  previewCtx: null,\n  showControls: true\n};\n\n// Initialize canvases\nconst mainCanvas = document.getElementById('game-canvas');\nconst previewCanvas = document.createElement('canvas');\npreviewCanvas.width = mainCanvas.width;\npreviewCanvas.height = mainCanvas.height;\n\nwindow._state.canvas = mainCanvas;\nwindow._state.ctx = mainCanvas.getContext('2d');\nwindow._state.previewCanvas = previewCanvas;\nwindow._state.previewCtx = previewCanvas.getContext('2d');\n\n// Save initial state\nwindow._state.history.push(\n  window._state.ctx.getImageData(0, 0, mainCanvas.width, mainCanvas.height)\n);\n\n// Setup audio\ntry {\n  window._synth = new Tone.Synth().toDestination();\n  window._effects = {\n    draw: () => window._synth.triggerAttackRelease('C4', '32n'),\n    undo: () => window._synth.triggerAttackRelease('G3', '16n'),\n    redo: () => window._synth.triggerAttackRelease('C4', '16n'),\n    clear: () => window._synth.triggerAttackRelease(['C3', 'G3'], '8n')\n  };\n} catch (e) { console.warn('Tone unavailable', e); }",
  "updateCode": "// Drawing App Update\n(function(){\n  const canvas = document.getElementById('game-canvas');\n  const ctx = window._ctx || canvas.getContext('2d');\n  const state = window._state;\n  if (!state) return;\n\n  function saveState() {\n    state.history.push(\n      ctx.getImageData(0, 0, canvas.width, canvas.height)\n    );\n    state.redoStack = [];\n    if (state.history.length > 50) state.history.shift(); // Limit history\n  }\n\n  function drawLine(ctx, x1, y1, x2, y2) {\n    ctx.beginPath();\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.stroke();\n  }\n\n  function drawRect(ctx, x1, y1, x2, y2) {\n    const width = x2 - x1;\n    const height = y2 - y1;\n    ctx.strokeRect(x1, y1, width, height);\n  }\n\n  function drawCircle(ctx, x1, y1, x2, y2) {\n    const radius = Math.sqrt(\n      Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2)\n    );\n    ctx.beginPath();\n    ctx.arc(x1, y1, radius, 0, Math.PI * 2);\n    ctx.stroke();\n  }\n\n  // Input handling\n  canvas.onmousedown = (e) => {\n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n    state.drawing = true;\n    state.lastX = x;\n    state.lastY = y;\n    state.startX = x;\n    state.startY = y;\n  };\n\n  canvas.onmousemove = (e) => {\n    if (!state.drawing) return;\n    \n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    // Configure drawing style\n    state.ctx.strokeStyle = state.color;\n    state.ctx.lineWidth = state.size;\n    state.ctx.lineCap = 'round';\n    state.ctx.lineJoin = 'round';\n\n    state.previewCtx.clearRect(0, 0, canvas.width, canvas.height);\n    state.previewCtx.strokeStyle = state.color;\n    state.previewCtx.lineWidth = state.size;\n    state.previewCtx.lineCap = 'round';\n    state.previewCtx.lineJoin = 'round';\n\n    if (state.tool === 'pencil') {\n      drawLine(state.ctx, state.lastX, state.lastY, x, y);\n      if (window._effects && Math.random() < 0.1) window._effects.draw();\n    } else {\n      // Preview for other tools\n      switch(state.tool) {\n        case 'line':\n          drawLine(state.previewCtx, state.startX, state.startY, x, y);\n          break;\n        case 'rect':\n          drawRect(state.previewCtx, state.startX, state.startY, x, y);\n          break;\n        case 'circle':\n          drawCircle(state.previewCtx, state.startX, state.startY, x, y);\n          break;\n      }\n    }\n\n    state.lastX = x;\n    state.lastY = y;\n  };\n\n  canvas.onmouseup = (e) => {\n    if (!state.drawing) return;\n    \n    const rect = canvas.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const y = e.clientY - rect.top;\n\n    if (state.tool !== 'pencil') {\n      state.ctx.strokeStyle = state.color;\n      state.ctx.lineWidth = state.size;\n      state.ctx.lineCap = 'round';\n      state.ctx.lineJoin = 'round';\n\n      switch(state.tool) {\n        case 'line':\n          drawLine(state.ctx, state.startX, state.startY, x, y);\n          break;\n        case 'rect':\n          drawRect(state.ctx, state.startX, state.startY, x, y);\n          break;\n        case 'circle':\n          drawCircle(state.ctx, state.startX, state.startY, x, y);\n          break;\n      }\n      state.previewCtx.clearRect(0, 0, canvas.width, canvas.height);\n      if (window._effects) window._effects.draw();\n    }\n\n    state.drawing = false;\n    saveState();\n  };\n\n  canvas.onmouseleave = () => {\n    state.drawing = false;\n  };\n\n  // Keyboard shortcuts\n  document.onkeydown = (e) => {\n    if (e.ctrlKey) {\n      switch(e.key) {\n        case 'z':\n          if (state.history.length > 1) {\n            state.redoStack.push(state.history.pop());\n            ctx.putImageData(state.history[state.history.length - 1], 0, 0);\n            if (window._effects) window._effects.undo();\n          }\n          break;\n        case 'y':\n          if (state.redoStack.length > 0) {\n            state.history.push(state.redoStack.pop());\n            ctx.putImageData(state.history[state.history.length - 1], 0, 0);\n            if (window._effects) window._effects.redo();\n          }\n          break;\n      }\n    } else {\n      switch(e.key) {\n        case 'h':\n          state.showControls = !state.showControls;\n          break;\n        case '1':\n          state.tool = 'pencil';\n          break;\n        case '2':\n          state.tool = 'line';\n          break;\n        case '3':\n          state.tool = 'rect';\n          break;\n        case '4':\n          state.tool = 'circle';\n          break;\n        case '+':\n        case '=':\n          state.size = Math.min(20, state.size + 1);\n          break;\n        case '-':\n          state.size = Math.max(1, state.size - 1);\n          break;\n        case 'c':\n          if (confirm('Clear canvas?')) {\n            ctx.fillStyle = '#000000';\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n            saveState();\n            if (window._effects) window._effects.clear();\n          }\n          break;\n      }\n    }\n  };\n\n  // Draw preview\n  ctx.drawImage(state.previewCanvas, 0, 0);\n\n  // Draw controls\n  if (state.showControls) {\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    ctx.fillRect(10, 10, 200, 180);\n\n    ctx.fillStyle = '#ffffff';\n    ctx.font = '12px monospace';\n    ctx.fillText('Controls:', 20, 30);\n    ctx.fillText('1-4: Change tool', 20, 50);\n    ctx.fillText('Current: ' + state.tool, 20, 70);\n    ctx.fillText('+/-: Brush size', 20, 90);\n    ctx.fillText('Size: ' + state.size, 20, 110);\n    ctx.fillText('Ctrl+Z: Undo', 20, 130);\n    ctx.fillText('Ctrl+Y: Redo', 20, 150);\n    ctx.fillText('C: Clear canvas', 20, 170);\n    ctx.fillText('H: Toggle help', 20, 190);\n  }\n})();",
  "displayMode": "1",
  "timestamp": "2025-11-04T00:00:00.000Z"
}