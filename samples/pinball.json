{
  "initCode": "// Pinball Init\nwindow._state = {\n  ball: { x: 58, y: 40, vx: 0, vy: 0 },\n  flippers: [\n    { x: 20, y: 56, angle: 0.6, direction: 1 },\n    { x: 44, y: 56, angle: -0.6, direction: -1 }\n  ],\n  bumpers: [\n    { x: 20, y: 20, radius: 3 },\n    { x: 44, y: 20, radius: 3 },\n    { x: 32, y: 32, radius: 4 }\n  ],\n  score: 0,\n  balls: 3,\n  lastBumper: null,\n  combo: 1,\n  gameOver: false,\n  message: '',\n  messageTimer: 0\n};\n\n// Setup audio\ntry {\n  window._synth = new Tone.PolySynth().toDestination();\n  const reverb = new Tone.Reverb().toDestination();\n  window._effects = {\n    flipper: () => {\n      window._synth.triggerAttackRelease('C3', '32n');\n      window._synth.connect(reverb);\n    },\n    bumper: (combo) => {\n      const notes = ['C4', 'E4', 'G4', 'C5'];\n      window._synth.triggerAttackRelease(notes[Math.min(combo-1, notes.length-1)], '16n');\n    },\n    launch: () => {\n      window._synth.triggerAttackRelease(['G4', 'B4', 'D5'], '8n');\n    },\n    lose: () => {\n      window._synth.triggerAttackRelease('C3', '4n');\n    },\n    gameOver: () => {\n      window._synth.triggerAttackRelease(['C3', 'G2', 'C2'], '2n');\n    }\n  };\n} catch (e) { console.warn('Tone unavailable', e); }",
  "updateCode": "// Pinball Update\n(function(){\n  const canvas = document.getElementById('game-canvas');\n  const ctx = window._ctx || canvas.getContext('2d');\n  const state = window._state;\n  if (!state || state.gameOver) return;\n\n  // Physics constants\n  const GRAVITY = 0.2;\n  const FRICTION = 0.98;\n  const FLIPPER_SPEED = 0.2;\n  const FLIPPER_LENGTH = 12;\n  const BUMPER_STRENGTH = 8;\n\n  // Input handling\n  document.onkeydown = (e) => {\n    if (state.gameOver) return;\n    switch(e.key) {\n      case 'ArrowLeft':\n        state.flippers[0].angle = Math.max(-0.2, state.flippers[0].angle - FLIPPER_SPEED);\n        if (window._effects) window._effects.flipper();\n        break;\n      case 'ArrowRight':\n        state.flippers[1].angle = Math.min(0.2, state.flippers[1].angle + FLIPPER_SPEED);\n        if (window._effects) window._effects.flipper();\n        break;\n      case ' ':\n        if (!state.ball.active) {\n          state.ball.vy = -10;\n          state.ball.active = true;\n          if (window._effects) window._effects.launch();\n        }\n        break;\n    }\n  };\n\n  document.onkeyup = (e) => {\n    switch(e.key) {\n      case 'ArrowLeft':\n        state.flippers[0].angle = Math.min(0.6, state.flippers[0].angle + FLIPPER_SPEED);\n        break;\n      case 'ArrowRight':\n        state.flippers[1].angle = Math.max(-0.6, state.flippers[1].angle - FLIPPER_SPEED);\n        break;\n    }\n  };\n\n  // Update ball physics\n  if (state.ball.active) {\n    state.ball.vy += GRAVITY;\n    state.ball.vx *= FRICTION;\n    state.ball.vy *= FRICTION;\n    state.ball.x += state.ball.vx;\n    state.ball.y += state.ball.vy;\n\n    // Wall collisions\n    if (state.ball.x < 4) {\n      state.ball.x = 4;\n      state.ball.vx *= -0.8;\n    }\n    if (state.ball.x > 60) {\n      state.ball.x = 60;\n      state.ball.vx *= -0.8;\n    }\n    if (state.ball.y < 4) {\n      state.ball.y = 4;\n      state.ball.vy *= -0.8;\n    }\n\n    // Flipper collisions\n    state.flippers.forEach(flipper => {\n      const dx = state.ball.x - flipper.x;\n      const dy = state.ball.y - flipper.y;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n      const angle = Math.atan2(dy, dx);\n      \n      if (dist < FLIPPER_LENGTH) {\n        const flipperAngle = flipper.angle * flipper.direction;\n        const normalAngle = flipperAngle + Math.PI/2;\n        const force = 15;\n        \n        state.ball.vx = Math.cos(normalAngle) * force;\n        state.ball.vy = Math.sin(normalAngle) * force;\n      }\n    });\n\n    // Bumper collisions\n    state.bumpers.forEach(bumper => {\n      const dx = state.ball.x - bumper.x;\n      const dy = state.ball.y - bumper.y;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n      \n      if (dist < bumper.radius + 1) {\n        const angle = Math.atan2(dy, dx);\n        state.ball.vx = Math.cos(angle) * BUMPER_STRENGTH;\n        state.ball.vy = Math.sin(angle) * BUMPER_STRENGTH;\n\n        if (bumper === state.lastBumper) {\n          state.combo++;\n        } else {\n          state.combo = 1;\n        }\n        state.lastBumper = bumper;\n\n        state.score += 100 * state.combo;\n        state.message = `${100 * state.combo} pts!`;\n        state.messageTimer = 30;\n        if (window._effects) window._effects.bumper(state.combo);\n      }\n    });\n\n    // Ball lost\n    if (state.ball.y > 64) {\n      state.balls--;\n      if (window._effects) window._effects.lose();\n      \n      if (state.balls <= 0) {\n        state.gameOver = true;\n        if (window._effects) window._effects.gameOver();\n      } else {\n        state.ball = { x: 58, y: 40, vx: 0, vy: 0, active: false };\n        state.lastBumper = null;\n        state.combo = 1;\n      }\n    }\n  }\n\n  // Update message timer\n  if (state.messageTimer > 0) state.messageTimer--;\n\n  // Clear screen\n  ctx.fillStyle = '#000044';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  const scale = canvas.width / 64;\n\n  // Draw walls\n  ctx.strokeStyle = '#4444ff';\n  ctx.lineWidth = scale * 2;\n  ctx.beginPath();\n  ctx.moveTo(2 * scale, 2 * scale);\n  ctx.lineTo(62 * scale, 2 * scale);\n  ctx.lineTo(62 * scale, 60 * scale);\n  ctx.lineTo(2 * scale, 60 * scale);\n  ctx.lineTo(2 * scale, 2 * scale);\n  ctx.stroke();\n\n  // Draw flippers\n  ctx.fillStyle = '#4444ff';\n  state.flippers.forEach(flipper => {\n    ctx.save();\n    ctx.translate(flipper.x * scale, flipper.y * scale);\n    ctx.rotate(flipper.angle * flipper.direction);\n    ctx.fillRect(-FLIPPER_LENGTH/2 * scale, -2 * scale, \n                 FLIPPER_LENGTH * scale, 4 * scale);\n    ctx.restore();\n  });\n\n  // Draw bumpers\n  state.bumpers.forEach(bumper => {\n    ctx.fillStyle = bumper === state.lastBumper ? '#ff4444' : '#4444ff';\n    ctx.beginPath();\n    ctx.arc(bumper.x * scale, \n            bumper.y * scale, \n            bumper.radius * scale, \n            0, Math.PI * 2);\n    ctx.fill();\n  });\n\n  // Draw ball\n  ctx.fillStyle = '#ffffff';\n  ctx.beginPath();\n  ctx.arc(state.ball.x * scale,\n          state.ball.y * scale,\n          scale,\n          0, Math.PI * 2);\n  ctx.fill();\n\n  // Draw launcher\n  ctx.fillStyle = '#4444ff';\n  ctx.fillRect(58 * scale, 40 * scale, 2 * scale, 20 * scale);\n\n  // Draw HUD\n  ctx.fillStyle = '#ffffff';\n  ctx.font = '20px monospace';\n  ctx.fillText(`Score: ${state.score}`, 20, 30);\n  ctx.fillText(`Balls: ${state.balls}`, canvas.width - 120, 30);\n  \n  if (state.combo > 1) {\n    ctx.fillText(`Combo: x${state.combo}`, 20, 60);\n  }\n\n  // Draw message\n  if (state.messageTimer > 0) {\n    ctx.font = '24px monospace';\n    ctx.fillStyle = `rgba(255, 255, 255, ${state.messageTimer / 30})`;\n    ctx.fillText(\n      state.message,\n      canvas.width/2 - ctx.measureText(state.message).width/2,\n      canvas.height/2\n    );\n  }\n\n  // Game over screen\n  if (state.gameOver) {\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    \n    ctx.fillStyle = '#ffffff';\n    ctx.font = '40px monospace';\n    ctx.fillText('Game Over!', canvas.width/4, canvas.height/2);\n    ctx.font = '20px monospace';\n    ctx.fillText(`Final Score: ${state.score}`, \n                 canvas.width/4, canvas.height/2 + 40);\n  }\n})();",
  "displayMode": "1",
  "timestamp": "2025-11-04T00:00:00.000Z"
}