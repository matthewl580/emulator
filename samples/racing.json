{
  "initCode": "// Racing Game Init\nwindow._state = {\n  player: {\n    x: 32,\n    y: 48,\n    speed: 0,\n    angle: 0\n  },\n  track: [\n    { x: 32, y: 32, radius: 24 },\n    { x: 48, y: 16, radius: 12 },\n    { x: 16, y: 16, radius: 12 }\n  ],\n  checkpoints: [\n    { x: 32, y: 8, reached: false },\n    { x: 56, y: 16, reached: false },\n    { x: 56, y: 48, reached: false },\n    { x: 8, y: 48, reached: false },\n    { x: 8, y: 16, reached: false }\n  ],\n  lap: 0,\n  time: 0,\n  bestTime: Infinity,\n  gameOver: false,\n  lastUpdate: Date.now()\n};\n\n// Setup audio\ntry {\n  window._synth = new Tone.Synth().toDestination();\n  window._effects = {\n    engine: () => window._synth.triggerAttackRelease('C2', '32n'),\n    checkpoint: () => window._synth.triggerAttackRelease('G4', '16n'),\n    crash: () => window._synth.triggerAttackRelease('C3', '8n')\n  };\n} catch (e) { console.warn('Tone unavailable', e); }",
  "updateCode": "// Racing Game Update\n(function(){\n  const canvas = document.getElementById('game-canvas');\n  const ctx = window._ctx || canvas.getContext('2d');\n  const state = window._state;\n  if (!state || state.gameOver) return;\n\n  // Time update\n  const now = Date.now();\n  const dt = (now - state.lastUpdate) / 1000;\n  state.lastUpdate = now;\n  state.time += dt;\n\n  // Input handling\n  const keys = {};\n  document.onkeydown = (e) => { keys[e.key] = true; };\n  document.onkeyup = (e) => { keys[e.key] = false; };\n\n  // Car physics\n  const ACCELERATION = 0.2;\n  const TURN_SPEED = 0.1;\n  const FRICTION = 0.98;\n\n  if (keys['ArrowUp']) {\n    state.player.speed += ACCELERATION;\n    if (window._effects && Math.random() < 0.1) window._effects.engine();\n  }\n  if (keys['ArrowDown']) state.player.speed -= ACCELERATION;\n  if (keys['ArrowLeft']) state.player.angle -= TURN_SPEED;\n  if (keys['ArrowRight']) state.player.angle += TURN_SPEED;\n\n  // Apply physics\n  state.player.speed *= FRICTION;\n  state.player.x += Math.cos(state.player.angle) * state.player.speed;\n  state.player.y += Math.sin(state.player.angle) * state.player.speed;\n\n  // Track collision\n  let onTrack = false;\n  state.track.forEach(circle => {\n    const dx = state.player.x - circle.x;\n    const dy = state.player.y - circle.y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    if (distance <= circle.radius) onTrack = true;\n  });\n\n  if (!onTrack) {\n    state.player.speed *= 0.8;\n    if (window._effects && Math.random() < 0.1) window._effects.crash();\n  }\n\n  // Checkpoint handling\n  state.checkpoints.forEach((checkpoint, i) => {\n    const dx = state.player.x - checkpoint.x;\n    const dy = state.player.y - checkpoint.y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    \n    if (distance < 4 && !checkpoint.reached) {\n      checkpoint.reached = true;\n      if (window._effects) window._effects.checkpoint();\n      \n      // Check if lap completed\n      if (i === state.checkpoints.length - 1 && \n          state.checkpoints.every(cp => cp.reached)) {\n        state.lap++;\n        if (state.time < state.bestTime) state.bestTime = state.time;\n        state.checkpoints.forEach(cp => cp.reached = false);\n        if (state.lap >= 3) state.gameOver = true;\n      }\n    }\n  });\n\n  // Clear screen\n  ctx.fillStyle = '#004400';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  const scale = canvas.width / 64;\n\n  // Draw track\n  ctx.fillStyle = '#666666';\n  state.track.forEach(circle => {\n    ctx.beginPath();\n    ctx.arc(circle.x * scale, \n            circle.y * scale, \n            circle.radius * scale, \n            0, Math.PI * 2);\n    ctx.fill();\n  });\n\n  // Draw checkpoints\n  state.checkpoints.forEach(checkpoint => {\n    ctx.fillStyle = checkpoint.reached ? '#00ff00' : '#ffff00';\n    ctx.fillRect(checkpoint.x * scale - scale, \n                 checkpoint.y * scale - scale, \n                 scale * 2, \n                 scale * 2);\n  });\n\n  // Draw player\n  ctx.save();\n  ctx.translate(state.player.x * scale, state.player.y * scale);\n  ctx.rotate(state.player.angle);\n  ctx.fillStyle = '#ff0000';\n  ctx.fillRect(-scale * 1.5, -scale, scale * 3, scale * 2);\n  ctx.restore();\n\n  // Draw HUD\n  ctx.fillStyle = '#ffffff';\n  ctx.font = '12px monospace';\n  ctx.fillText(`Lap: ${state.lap + 1}/3  Time: ${state.time.toFixed(1)}`, 10, 20);\n  if (state.bestTime < Infinity) {\n    ctx.fillText(`Best: ${state.bestTime.toFixed(1)}`, 10, 40);\n  }\n\n  // Game over\n  if (state.gameOver) {\n    ctx.fillStyle = '#ffffff';\n    ctx.font = '24px monospace';\n    ctx.fillText('Race Complete!', canvas.width/4, canvas.height/2);\n    ctx.font = '16px monospace';\n    ctx.fillText(`Final Time: ${state.time.toFixed(1)}`, canvas.width/4, canvas.height/2 + 30);\n  }\n})();",
  "displayMode": "1",
  "timestamp": "2025-11-04T00:00:00.000Z"
}