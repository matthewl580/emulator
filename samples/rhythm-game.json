{
  "initCode": "// Rhythm Game Init\nwindow._state = {\n  notes: [],\n  score: 0,\n  combo: 0,\n  maxCombo: 0,\n  health: 100,\n  gameOver: false,\n  spawnTimer: 0,\n  judgementText: '',\n  judgementTimer: 0,\n  track: [\n    { note: 'C4', time: 60 },\n    { note: 'E4', time: 90 },\n    { note: 'G4', time: 120 },\n    { note: 'C5', time: 150 },\n    { note: 'G4', time: 180 },\n    { note: 'E4', time: 210 }\n  ],\n  trackIndex: 0,\n  bpm: 120\n};\n\n// Setup audio\ntry {\n  window._synth = new Tone.PolySynth(Tone.Synth, {\n    oscillator: { type: 'triangle' },\n    envelope: { attack: 0.05, decay: 0.1, sustain: 0.3, release: 0.4 }\n  }).toDestination();\n  window._effects = {\n    perfect: () => {\n      window._synth.triggerAttackRelease(['C5', 'E5', 'G5'], '16n');\n    },\n    good: () => {\n      window._synth.triggerAttackRelease(['C5', 'E5'], '16n');\n    },\n    miss: () => {\n      window._synth.triggerAttackRelease('C3', '8n');\n    },\n    gameOver: () => {\n      window._synth.triggerAttackRelease(['C4', 'G3', 'C3'], '2n');\n    },\n    trackNote: (note) => {\n      window._synth.triggerAttackRelease(note, '8n');\n    }\n  };\n\n  // Start the background track\n  Tone.Transport.bpm.value = window._state.bpm;\n  Tone.Transport.start();\n} catch (e) { console.warn('Tone unavailable', e); }",
  "updateCode": "// Rhythm Game Update\n(function(){\n  const canvas = document.getElementById('game-canvas');\n  const ctx = window._ctx || canvas.getContext('2d');\n  const state = window._state;\n  if (!state || state.gameOver) return;\n\n  // Constants\n  const NOTE_SPEED = 4;\n  const HIT_ZONE_Y = canvas.height - 100;\n  const PERFECT_RANGE = 10;\n  const GOOD_RANGE = 20;\n\n  // Input handling\n  document.onkeydown = (e) => {\n    if (state.gameOver) return;\n    if (e.key === ' ' || e.key === 'j' || e.key === 'k') {\n      // Find closest note\n      let closestNote = null;\n      let closestDist = Infinity;\n      \n      state.notes.forEach(note => {\n        if (!note.hit) {\n          const dist = Math.abs(note.y - HIT_ZONE_Y);\n          if (dist < closestDist) {\n            closestDist = dist;\n            closestNote = note;\n          }\n        }\n      });\n\n      if (closestNote) {\n        if (closestDist <= PERFECT_RANGE) {\n          state.score += 100;\n          state.combo++;\n          state.judgementText = 'PERFECT!';\n          if (window._effects) window._effects.perfect();\n        } else if (closestDist <= GOOD_RANGE) {\n          state.score += 50;\n          state.combo++;\n          state.judgementText = 'GOOD!';\n          if (window._effects) window._effects.good();\n        } else {\n          state.combo = 0;\n          state.health -= 5;\n          state.judgementText = 'MISS';\n          if (window._effects) window._effects.miss();\n        }\n        closestNote.hit = true;\n        state.judgementTimer = 30;\n        state.maxCombo = Math.max(state.maxCombo, state.combo);\n      }\n    }\n  };\n\n  // Spawn notes from track\n  state.spawnTimer++;\n  if (state.trackIndex < state.track.length && \n      state.spawnTimer >= state.track[state.trackIndex].time) {\n    state.notes.push({\n      x: canvas.width / 2,\n      y: 0,\n      hit: false,\n      note: state.track[state.trackIndex].note\n    });\n    if (window._effects) window._effects.trackNote(state.track[state.trackIndex].note);\n    state.trackIndex++;\n  }\n\n  // Update notes\n  state.notes = state.notes.filter(note => {\n    note.y += NOTE_SPEED;\n    \n    // Miss if note goes too low\n    if (note.y > canvas.height && !note.hit) {\n      state.combo = 0;\n      state.health -= 10;\n      state.judgementText = 'MISS';\n      state.judgementTimer = 30;\n      if (window._effects) window._effects.miss();\n    }\n    \n    return note.y < canvas.height;\n  });\n\n  // Update judgement timer\n  if (state.judgementTimer > 0) state.judgementTimer--;\n\n  // Update health\n  if (state.health <= 0) {\n    state.health = 0;\n    state.gameOver = true;\n    if (window._effects) window._effects.gameOver();\n  }\n\n  // Clear screen\n  ctx.fillStyle = '#000022';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  // Draw hit zone\n  ctx.strokeStyle = '#ffffff';\n  ctx.lineWidth = 2;\n  ctx.beginPath();\n  ctx.moveTo(0, HIT_ZONE_Y);\n  ctx.lineTo(canvas.width, HIT_ZONE_Y);\n  ctx.stroke();\n\n  // Draw perfect zone\n  ctx.strokeStyle = '#00ff00';\n  ctx.beginPath();\n  ctx.moveTo(0, HIT_ZONE_Y - PERFECT_RANGE);\n  ctx.lineTo(canvas.width, HIT_ZONE_Y - PERFECT_RANGE);\n  ctx.moveTo(0, HIT_ZONE_Y + PERFECT_RANGE);\n  ctx.lineTo(canvas.width, HIT_ZONE_Y + PERFECT_RANGE);\n  ctx.stroke();\n\n  // Draw notes\n  state.notes.forEach(note => {\n    if (!note.hit) {\n      ctx.fillStyle = '#ffffff';\n      ctx.beginPath();\n      ctx.arc(note.x, note.y, 15, 0, Math.PI * 2);\n      ctx.fill();\n    }\n  });\n\n  // Draw HUD\n  ctx.fillStyle = '#ffffff';\n  ctx.font = '20px monospace';\n  ctx.fillText(`Score: ${state.score}`, 20, 30);\n  ctx.fillText(`Combo: ${state.combo}`, 20, 60);\n  ctx.fillText(`Max Combo: ${state.maxCombo}`, 20, 90);\n\n  // Draw health bar\n  ctx.fillStyle = '#ff0000';\n  ctx.fillRect(canvas.width - 220, 20, 200, 20);\n  ctx.fillStyle = '#00ff00';\n  ctx.fillRect(canvas.width - 220, 20, state.health * 2, 20);\n\n  // Draw judgement text\n  if (state.judgementTimer > 0) {\n    ctx.font = '30px monospace';\n    ctx.fillStyle = state.judgementText === 'PERFECT!' ? '#00ff00' : \n                   state.judgementText === 'GOOD!' ? '#ffff00' : '#ff0000';\n    ctx.fillText(\n      state.judgementText,\n      canvas.width/2 - ctx.measureText(state.judgementText).width/2,\n      canvas.height - 50\n    );\n  }\n\n  // Game over screen\n  if (state.gameOver) {\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    \n    ctx.fillStyle = '#ffffff';\n    ctx.font = '40px monospace';\n    ctx.fillText('Game Over!', canvas.width/4, canvas.height/2);\n    ctx.font = '20px monospace';\n    ctx.fillText(`Final Score: ${state.score}`, canvas.width/4, canvas.height/2 + 40);\n    ctx.fillText(`Max Combo: ${state.maxCombo}`, canvas.width/4, canvas.height/2 + 70);\n  }\n\n  // Victory check\n  if (state.trackIndex >= state.track.length && state.notes.length === 0) {\n    state.gameOver = true;\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    \n    ctx.fillStyle = '#00ff00';\n    ctx.font = '40px monospace';\n    ctx.fillText('Stage Clear!', canvas.width/4, canvas.height/2);\n    ctx.font = '20px monospace';\n    ctx.fillText(`Final Score: ${state.score}`, canvas.width/4, canvas.height/2 + 40);\n    ctx.fillText(`Max Combo: ${state.maxCombo}`, canvas.width/4, canvas.height/2 + 70);\n  }\n})();",
  "displayMode": "1",
  "timestamp": "2025-11-04T00:00:00.000Z"
}